<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.L.E.R. - App Oficial - Jonatan Ribot</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; font-family: sans-serif; }
        .sler-output {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre;
            line-height: 1.5;
            background: #ffffff;
            color: #1f2937;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function MobileSLERApp() {
            const [text, setText] = useState('');
            const [isSlerActive, setIsSlerActive] = useState(false);
            const [showPrintModal, setShowPrintModal] = useState(false);
            const [printWidth, setPrintWidth] = useState(30);
            const ANCHO_MOLDE = 30;

            const motorSegmentador = (input, ancho) => {
                if (!input) return "";
                let palabras = input.trim().split(/\s+/);
                let lineas = [];
                let lineaActual = "";

                for (let i = 0; i < palabras.length; i++) {
                    let p = palabras[i];
                    let espacioDisp = ancho - lineaActual.length - (lineaActual ? 1 : 0);

                    if (p.length <= espacioDisp) {
                        lineaActual += (lineaActual ? " " : "") + p;
                    } else if (p.length > 6 && espacioDisp >= 3) {
                        // REGLA DE GUIONES: Mínimo 2 letras por sílaba
                        let corte = espacioDisp - 1; 
                        if (corte < 2) corte = 2;
                        if (p.length - corte < 2) corte = p.length - 2;

                        let parte1 = p.substring(0, corte) + "-";
                        let parte2 = p.substring(corte);
                        
                        lineaActual += (lineaActual ? " " : "") + parte1;
                        lineas.push(lineaActual.padEnd(ancho, '.'));
                        lineaActual = parte2;
                    } else {
                        lineas.push(lineaActual.padEnd(ancho, '.'));
                        lineaActual = p;
                    }
                }
                if (lineaActual) lineas.push(lineaActual.padEnd(ancho, '.'));

                return lineas.map((lin, idx) => {
                    if (idx % 2 !== 0) return "......" + lin.split('').reverse().join('');
                    return lin + "......";
                }).join('\n');
            };

            const handleKeyDown = (e) => {
                // Bloqueo de Enter para obligar al tope del renglón
                if (e.key === "Enter") {
                    let palabras = text.trim().split(/\s+/);
                    let ultimaPalabra = palabras[palabras.length - 1] || "";
                    if (text.length % ANCHO_MOLDE !== 0) {
                        e.preventDefault();
                        alert("S.L.E.R. info: Debe completar el renglón hasta el tope para avanzar. Respete la isometría.");
                    }
                }
            };

            return (
                <div className="max-w-3xl mx-auto my-10 p-6 bg-white shadow-2xl rounded-xl border-b-8 border-blue-600">
                    <header className="text-center mb-8">
                        <h1 className="text-3xl font-black text-blue-800 tracking-tighter">S.L.E.R.</h1>
                        <p className="text-sm font-semibold text-gray-600 uppercase">Sistema de Lectura y Escritura Recíproco</p>
                        <p className="text-xs text-blue-500 mt-1">Jonatan Ribot - IP 2025 Argentina</p>
                    </header>

                    <textarea 
                        className="w-full h-48 p-4 border-2 border-gray-200 rounded-lg focus:border-blue-500 outline-none font-mono"
                        placeholder="Escriba aquí respetando el tope del renglón..."
                        value={text}
                        onKeyDown={handleKeyDown}
                        onChange={(e) => setText(e.target.value)}
                    />

                    <div className="flex gap-4 mt-4">
                        <button onClick={() => setIsSlerActive(!isSlerActive)} className="flex-1 py-4 bg-blue-600 text-white rounded-lg font-bold">
                            {isSlerActive ? 'MODO NORMAL' : 'APLICAR S.L.E.R.'}
                        </button>
                        <button onClick={() => setShowPrintModal(true)} className="bg-gray-800 text-white px-6 rounded-lg font-bold">
                            IMPRIMIR / EXPORTAR
                        </button>
                    </div>

                    {isSlerActive && (
                        <div className="mt-8 p-6 bg-gray-50 rounded-lg sler-output text-lg border-l-4 border-blue-500">
                            {motorSegmentador(text, ANCHO_MOLDE)}
                        </div>
                    )}

                    {/* MODAL DE IMPRESIÓN */}
                    {showPrintModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4">
                            <div className="bg-white p-8 rounded-xl max-w-sm w-full">
                                <h2 className="font-bold mb-4">Configurar Extensión Isométrica</h2>
                                <input 
                                    type="range" min="30" max="120" value={printWidth} 
                                    onChange={(e) => setPrintWidth(e.target.value)}
                                    className="w-full mb-2"
                                />
                                <p className="text-center font-mono mb-6">{printWidth} caracteres</p>
                                <div className="flex gap-2">
                                    <button onClick={() => {
                                        const win = window.open("", "_blank");
                                        win.document.write(`<pre style="font-family:monospace">${motorSegmentador(text, printWidth)}</pre>`);
                                        win.print();
                                    }} className="flex-1 bg-blue-600 text-white py-2 rounded">Imprimir</button>
                                    <button onClick={() => setShowPrintModal(false)} className="flex-1 bg-gray-200 py-2 rounded">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <footer className="mt-12 text-[10px] text-center text-gray-400 border-t pt-4">
                        Bell Ville, Córdoba - Propiedad Intelectual 2025 Jonatan Ribot
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MobileSLERApp />);
    </script>
</body>
</html>
